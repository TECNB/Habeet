"use strict";const a=require("../../common/vendor.js"),t=require("../../common/assets.js"),e=require("../../store/target.js"),d=require("../../store/tag.js"),r=require("../../store/user.js"),i=require("../../store/time.js"),s={__name:"Home",setup(s){const o=a.inject("url"),n=e.useTargetStore(),u=r.useUserStore(),g=d.useTagStore(),l=i.useTimeStore(),m=a.reactive({showClearIcon1:!1,showtargetMenuDetail:!1,showtargetArrowUp:!0,showtargetArrowDown:!1,targetWithTime:[],targetNoTime:[],dayList:[]}),c=()=>{a.index.redirectTo({url:"../../pages/Nav/Nav"})},h=a=>{m.inputClearValue1=a.detail.value,a.detail.value.length>0?m.showClearIcon1=!0:m.showClearIcon1=!1},D=()=>{u.data.userEmail=null,m.showClearIcon1=!1},w=()=>{f(u.data.userEmail)?(a.index.request({url:o+"/user/home",method:"POST",data:u.data.userEmail,success:t=>{null!=t.data.code?(a.index.redirectTo({url:"../../pages/Login/Login"}),a.index.request({url:o+"/tag/get",method:"POST",data:u.data.userEmail,success:a=>{console.log(a),g.data.tagName=a.data.data[0].tagName,g.data.tagDescribe=a.data.data[0].tagDescribe,g.data.tagPoint=a.data.data[0].tagPoint,g.data.tagHour=a.data.data[0].tagHour,g.data.tagMinute=a.data.data[0].tagMinute}}),a.index.request({url:o+"/target/get",method:"POST",data:{userEmail:u.data.userEmail,ifTargetUpdate:1},success:a=>{n.data.deadlineDate=[];for(let t=0;t<a.data.data.length;t++)if(0==a.data.data[t].status)m.targetNoTime.push({targetName:a.data.data[t].targetName,targetDescribe:a.data.data[t].targetDescribe,targetPoint:a.data.data[t].targetPoint,deadline:a.data.data[t].deadline,targetId:a.data.data[t].targetId});else if(1==a.data.data[t].status){let e=new Date(a.data.data[t].deadline);n.data.deadlineDate.includes(e)||n.data.deadlineDate.push(e),m.targetWithTime.push({targetName:a.data.data[t].targetName,targetDescribe:a.data.data[t].targetDescribe,targetPoint:a.data.data[t].targetPoint,deadline:a.data.data[t].deadline,targetId:a.data.data[t].targetId})}}})):(a.index.redirectTo({url:"../../pages/Sign/Sign"}),u.data.ifUpdate=0)}}),a.onMounted((()=>{const a=new Date(l.getFullYear(),m.dayList[0].month,1);l=new Date(a),l.setDate(m.dayList[0].day),l.setMonth(m.dayList[0].month),n.data.currentTime=l.toString(),n.data.dayDiff=[],n.data.ifshowDay=[],n.data.deadlineDate.forEach((a=>{let t=new Date(n.data.currentTime),e=a.getTime()-t.getTime(),d=Math.floor(e/864e5);if(d>0)n.data.ifshowDay.push(!0);else if(d<0){d=`${a.getMonth()+1}.${a.getDate()}`,n.data.ifshowDay.push(!1)}else{d=`${a.getHours()}:${a.getMinutes().toString().padStart(2,"0")}`,n.data.ifshowDay.push(!1)}n.data.dayDiff.push(d)}))})),l.data.remainingTime=3600*g.data.tagHour+60*g.data.tagMinute+g.data.tagSecond):a.index.showToast({icon:"none",title:"QQ邮箱格式错误"})},f=a=>/^[1-9]\d{4,10}@qq\.com$/.test(a);return(e,d)=>a.e({a:t._imports_0$2,b:a.o(c),c:a.o([t=>a.unref(u).data.userEmail=t.detail.value,h]),d:a.unref(u).data.userEmail,e:m.showClearIcon1},m.showClearIcon1?{f:t._imports_2$3,g:a.o(D)}:{},{h:a.o(w)})}};wx.createPage(s);
