"use strict";const t=require("../../common/vendor.js"),a=require("../../common/assets.js"),e=require("../../store/target.js"),r=require("../../store/user.js");if(!Array){(t.resolveComponent("navbar")+t.resolveComponent("target-day")+t.resolveComponent("target-nav")+t.resolveComponent("uni-transition")+t.resolveComponent("uni-popup-dialog")+t.resolveComponent("uni-popup"))()}Math||((()=>"../../components/navbar/navbar.js")+(()=>"../../components/target-day/target-day.js")+(()=>"../../components/target-nav/target-nav.js")+(()=>"../../uni_modules/uni-transition/components/uni-transition/uni-transition.js")+(()=>"../../uni_modules/uni-popup/components/uni-popup-dialog/uni-popup-dialog.js")+(()=>"../../uni_modules/uni-popup/components/uni-popup/uni-popup.js"))();const d={__name:"Target",setup(d){const i=t.inject("url"),o=r.useUserStore(),g=t.reactive({targetNoTime:[],targetWithTime:[],targetCompleted:[],targetExpire:[],ifshowButton:!0,ifshowTargetTaskNull0:!1,ifshowTargetTaskNull1:!1,ifshowTargetTaskPAT:!1,ifshowTargetTaskPATDelete:!0,index:0}),s=e.useTargetStore();(s.data.Done||s.data.Expire)&&(s.data.ifshowTargetTaskNull0=!1,s.data.ifshowTargetTaskNull1=!1),t.onMounted((()=>{s.data.targetName="",s.data.targetDescribe="",s.data.targetHour="",s.data.deadline="",s.data.targetPoint=0,s.data.ifTargetUpdate=0,t.index.request({url:i+"/target/get",method:"POST",data:{userEmail:o.data.userEmail,ifTargetUpdate:0},success:t=>{s.data.deadlineDate=[];for(let a=0;a<t.data.data.length;a++)if(0==t.data.data[a].status)g.targetNoTime.push({targetName:t.data.data[a].targetName,targetDescribe:t.data.data[a].targetDescribe,targetPoint:t.data.data[a].targetPoint,deadline:t.data.data[a].deadline,targetId:t.data.data[a].targetId});else if(1==t.data.data[a].status){let e=new Date(t.data.data[a].deadline);s.data.deadlineDate.includes(e)||s.data.deadlineDate.push(e),s.data.dayDiff=[],s.data.ifshowDay=[],s.data.deadlineDate.forEach((t=>{console.log("在这里");let a=new Date(s.data.currentTime),e=t.getTime()-a.getTime(),r=Math.floor(e/864e5);if(r>0)s.data.ifshowDay.push(!0);else if(r<0){r=`${t.getMonth()+1}.${t.getDate()}`,s.data.ifshowDay.push(!1)}else{r=`${t.getHours()}:${t.getMinutes().toString().padStart(2,"0")}`,s.data.ifshowDay.push(!1)}s.data.dayDiff.push(r)})),g.targetWithTime.push({targetName:t.data.data[a].targetName,targetDescribe:t.data.data[a].targetDescribe,targetPoint:t.data.data[a].targetPoint,deadline:t.data.data[a].deadline,targetId:t.data.data[a].targetId}),console.log(g.targetWithTime)}else 2==t.data.data[a].status?g.targetCompleted.push({targetName:t.data.data[a].targetName,targetDescribe:t.data.data[a].targetDescribe,targetPoint:t.data.data[a].targetPoint,deadline:t.data.data[a].deadline,targetId:t.data.data[a].targetId}):3==t.data.data[a].status&&g.targetExpire.push({targetName:t.data.data[a].targetName,targetDescribe:t.data.data[a].targetDescribe,targetPoint:t.data.data[a].targetPoint,deadline:t.data.data[a].deadline,targetId:t.data.data[a].targetId});s.data.targetNoTimeLength=g.targetNoTime.length,s.data.targetWithTimeLength=g.targetWithTime.length,s.data.targetCompletedLength=g.targetCompleted.length,s.data.targetExpireLength=g.targetExpire.length,1==s.data.Doing&&(s.data.ifshowTargetTaskNull2=!1,s.data.ifshowTargetTaskNull3=!1,0==s.data.targetNoTimeLength&&(s.data.ifshowTargetTaskNull0=!0),0==s.data.targetWithTimeLength&&(s.data.ifshowTargetTaskNull1=!0)),1==s.data.Done&&(s.data.ifshowTargetTaskNull0=!1,s.data.ifshowTargetTaskNull1=!1,s.data.ifshowTargetTaskNull3=!1,0==s.data.targetCompletedLength&&(s.data.ifshowTargetTaskNull2=!0)),1==s.data.Expire&&(s.data.ifshowTargetTaskNull0=!1,s.data.ifshowTargetTaskNull1=!1,s.data.ifshowTargetTaskNull2=!1,0==s.data.targetExpireLength&&(s.data.ifshowTargetTaskNull3=!0))}})}));const n=a=>{s.data.targetName=g.targetNoTime[a].targetName,s.data.targetDescribe=g.targetNoTime[a].targetDescribe,s.data.targetPoint=g.targetNoTime[a].targetPoint,s.data.deadline=g.targetNoTime[a].deadline,s.data.ifTargetUpdate=1,s.data.targetId=g.targetNoTime[a].targetId,t.index.redirectTo({url:"../../pages/TargetCreat/TargetCreat"})},l=a=>{s.data.targetName=g.targetWithTime[a].targetName,s.data.targetDescribe=g.targetWithTime[a].targetDescribe,s.data.targetPoint=g.targetWithTime[a].targetPoint,s.data.deadline=g.targetWithTime[a].deadline,s.data.ifTargetUpdate=1,s.data.targetId=g.targetWithTime[a].targetId,t.index.redirectTo({url:"../../pages/TargetCreat/TargetCreat"})},u=a=>{s.data.targetName=g.targetCompleted[a].targetName,s.data.targetDescribe=g.targetCompleted[a].targetDescribe,s.data.targetPoint=g.targetCompleted[a].targetPoint,s.data.deadline=g.targetCompleted[a].deadline,s.data.ifTargetUpdate=1,s.data.targetId=g.targetCompleted[a].targetId,t.index.redirectTo({url:"../../pages/TargetCreat/TargetCreat"})},T=a=>{s.data.targetName=g.targetExpire[a].targetName,s.data.targetDescribe=g.targetExpire[a].targetDescribe,s.data.targetPoint=g.targetExpire[a].targetPoint,s.data.deadline=g.targetExpire[a].deadline,s.data.ifTargetUpdate=1,s.data.targetId=g.targetExpire[a].targetId,t.index.redirectTo({url:"../../pages/TargetCreat/TargetCreat"})};let m=t.ref(null),p=t.ref(null),h=t.ref(null),f=t.ref(null);const c=()=>{m.value.close(),t.index.request({url:i+"/target/delete",method:"POST",data:{targetName:g.targetNoTime[g.index].targetName,userEmail:o.data.userEmail,ifPoints:0,targetId:g.targetNoTime[g.index].targetId},success:a=>{t.index.showToast({icon:"none",title:"删除目标"}),s.data.targetNoTimeLength--,0==s.data.targetNoTimeLength&&(s.data.ifshowTargetTaskNull0=!0),g.targetNoTime.splice(g.index,1),o.data.point=a.data.data.targetPoint}})},N=()=>{p.value.close(),t.index.request({url:i+"/target/delete",method:"POST",data:{targetName:g.targetWithTime[g.index].targetName,userEmail:o.data.userEmail,ifPoints:0,targetId:g.targetWithTime[g.index].targetId},success:a=>{t.index.showToast({icon:"none",title:"删除目标"}),s.data.targetWithTimeLength--,0==s.data.targetWithTimeLength&&(s.data.ifshowTargetTaskNull1=!0),g.targetWithTime.splice(g.index,1),o.data.point=a.data.data.targetPoint}})},w=()=>{h.value.close(),t.index.request({url:i+"/target/delete",method:"POST",data:{targetName:g.targetCompleted[g.index].targetName,userEmail:o.data.userEmail,ifPoints:0,targetId:g.targetCompleted[g.index].targetId},success:a=>{t.index.showToast({icon:"none",title:"删除目标"}),s.data.targetCompletedLength--,0==s.data.targetCompletedLength&&(s.data.ifshowTargetTaskNull2=!0),g.targetCompleted.splice(g.index,1),o.data.point=a.data.data.targetPoint}})},x=()=>{f.value.close(),t.index.request({url:i+"/target/delete",method:"POST",data:{targetName:g.targetExpire[g.index].targetName,userEmail:o.data.userEmail,ifPoints:0,targetId:g.targetExpire[g.index].targetId},success:a=>{t.index.showToast({icon:"none",title:"删除目标"}),s.data.targetExpireLength--,0==s.data.targetExpireLength&&(s.data.ifshowTargetTaskNull3=!0),g.targetExpire.splice(g.index,1),o.data.point=a.data.data.targetPoint}})},D=()=>{m.value.close(),p.value.close(),h.value.close(),f.value.close()};return(e,r)=>t.e({a:t.p({navbarTo:"/menu/2"}),b:t.unref(s).data.Doing},(t.unref(s).data.Doing,{}),{c:t.unref(s).data.Doing},t.unref(s).data.Doing?{d:t.f(g.targetNoTime,((e,r,d)=>t.e({a:t.o((t=>n(r)),r),b:t.t(e.targetName),c:t.t(e.targetDescribe),d:t.o((t=>n(r)),r)},t.unref(s).data.ifshowTargetTaskPAT?{e:a._imports_4,f:t.t(e.targetPoint),g:t.o((a=>(a=>{t.index.request({url:i+"/target/delete",method:"POST",data:{userEmail:o.data.userEmail,targetName:g.targetNoTime[a].targetName,ifPoints:1,targetId:g.targetNoTime[g.index].targetId},success:e=>{t.index.showToast({icon:"none",title:"完成目标"}),s.data.targetNoTimeLength--,s.data.targetCompletedLength++,0==s.data.targetNoTimeLength&&(s.data.ifshowTargetTaskNull0=!0),g.targetCompleted.push({targetName:g.targetNoTime[a].targetName,targetDescribe:g.targetNoTime[a].targetDescribe,targetPoint:g.targetNoTime[a].targetPoint,deadline:g.targetNoTime[a].deadline,targetId:g.targetNoTime[a].targetId}),g.targetNoTime.splice(a,1),o.data.point=e.data.data.targetPoint}})})(r)),r)}:{},{h:"4accddd1-3-"+d,i:t.o((t=>(t=>{m.value.open(),g.index=t})(r)),r),j:"4accddd1-4-"+d,k:r}))),e:a._imports_0$6,f:t.unref(s).data.ifshowTargetTaskPAT,g:t.p({"mode-class":"fade",show:t.unref(s).data.ifshowTargetTaskPAT}),h:a._imports_2$4,i:t.p({"mode-class":"fade",show:t.unref(s).data.ifshowTargetTaskPATDelete})}:{},{j:t.unref(s).data.ifshowTargetTaskNull0},t.unref(s).data.ifshowTargetTaskNull0?{k:a._imports_0$6}:{},{l:t.unref(s).data.Doing},(t.unref(s).data.Doing,{}),{m:t.unref(s).data.Doing},t.unref(s).data.Doing?{n:t.f(g.targetWithTime,((a,e,r)=>({a:t.o((t=>l(e)),e),b:t.t(a.targetName),c:t.t(a.targetDescribe),d:t.o((t=>l(e)),e),e:t.t(a.targetPoint),f:t.o((a=>(a=>{t.index.request({url:i+"/target/delete",method:"POST",data:{userEmail:o.data.userEmail,targetName:g.targetWithTime[a].targetName,ifPoints:1,targetId:g.targetWithTime[g.index].targetId},success:e=>{t.index.showToast({icon:"none",title:"完成目标"}),s.data.targetWithTimeLength--,s.data.targetCompletedLength++,0==s.data.targetWithTimeLength&&(s.data.ifshowTargetTaskNull1=!0),g.targetCompleted.push({targetName:g.targetWithTime[a].targetName,targetDescribe:g.targetWithTime[a].targetDescribe,targetPoint:g.targetWithTime[a].targetPoint,deadline:g.targetWithTime[a].deadline,targetId:g.targetWithTime[a].targetId}),g.targetWithTime.splice(a,1),o.data.point=e.data.data.targetPoint}})})(e)),e),g:t.t(t.unref(s).data.dayDiff[e]),h:t.unref(s).data.ifshowDay[e],i:"4accddd1-5-"+r,j:t.o((t=>(t=>{p.value.open(),g.index=t})(e)),e),k:"4accddd1-6-"+r,l:e}))),o:a._imports_0$6,p:a._imports_4,q:t.p({"mode-class":"fade",show:t.unref(s).data.ifshowTargetTaskPAT}),r:a._imports_2$4,s:t.p({"mode-class":"fade",show:t.unref(s).data.ifshowTargetTaskPATDelete})}:{},{t:t.unref(s).data.ifshowTargetTaskNull1},t.unref(s).data.ifshowTargetTaskNull1?{v:a._imports_0$6}:{},{w:t.unref(s).data.Done},(t.unref(s).data.Done,{}),{x:t.unref(s).data.Done},t.unref(s).data.Done?{y:t.f(g.targetCompleted,((a,e,r)=>({a:t.o((t=>u(e)),e),b:t.t(a.targetName),c:t.t(a.targetDescribe),d:t.o((t=>u(e)),e),e:t.t(a.targetPoint),f:t.o((a=>{t.index.showToast({icon:"none",title:"已经完成啦"})}),e),g:"4accddd1-7-"+r,h:t.o((t=>(t=>{h.value.open(),g.index=t})(e)),e),i:"4accddd1-8-"+r,j:e}))),z:a._imports_0$6,A:a._imports_4,B:t.p({"mode-class":"fade",show:t.unref(s).data.ifshowTargetTaskPAT}),C:a._imports_2$4,D:t.p({"mode-class":"fade",show:t.unref(s).data.ifshowTargetTaskPATDelete})}:{},{E:t.unref(s).data.ifshowTargetTaskNull2},t.unref(s).data.ifshowTargetTaskNull2?{F:a._imports_0$6}:{},{G:t.unref(s).data.Expire},(t.unref(s).data.Expire,{}),{H:t.unref(s).data.Expire},t.unref(s).data.Expire?{I:t.f(g.targetExpire,((a,e,r)=>({a:t.o((t=>T(e)),e),b:t.t(a.targetName),c:t.t(a.targetDescribe),d:t.o((t=>T(e)),e),e:t.t(a.targetPoint),f:t.o((a=>{t.index.showToast({icon:"none",title:"已经过期啦"})}),e),g:"4accddd1-9-"+r,h:t.o((t=>(t=>{f.value.open(),g.index=t})(e)),e),i:"4accddd1-10-"+r,j:e}))),J:a._imports_0$6,K:a._imports_4,L:t.p({"mode-class":"fade",show:t.unref(s).data.ifshowTargetTaskPAT}),M:a._imports_2$4,N:t.p({"mode-class":"fade",show:t.unref(s).data.ifshowTargetTaskPATDelete})}:{},{O:t.unref(s).data.ifshowTargetTaskNull3},t.unref(s).data.ifshowTargetTaskNull3?{P:a._imports_0$6}:{},{Q:g.ifshowButton},g.ifshowButton?{R:a._imports_3$1}:{},{S:t.o(D),T:t.o(c),U:t.p({type:"error",mode:"base",title:"确定要删除吗?",content:"删除后将会从您的目标移除数据",duration:2e3,"before-close":!0}),V:t.sr(m,"4accddd1-11",{k:"popup"}),W:t.p({type:"dialog"}),X:t.o(D),Y:t.o(N),Z:t.p({type:"error",mode:"base",title:"确定要删除吗?",content:"删除后将会从您的目标移除数据",duration:2e3,"before-close":!0}),aa:t.sr(p,"4accddd1-13",{k:"popup2"}),ab:t.p({type:"dialog"}),ac:t.o(D),ad:t.o(w),ae:t.p({type:"error",mode:"base",title:"确定要删除吗?",content:"删除后将会从您的目标移除数据",duration:2e3,"before-close":!0}),af:t.sr(h,"4accddd1-15",{k:"popup3"}),ag:t.p({type:"dialog"}),ah:t.o(D),ai:t.o(x),aj:t.p({type:"error",mode:"base",title:"确定要删除吗?",content:"删除后将会从您的目标移除数据",duration:2e3,"before-close":!0}),ak:t.sr(f,"4accddd1-17",{k:"popup4"}),al:t.p({type:"dialog"})})}};wx.createPage(d);
