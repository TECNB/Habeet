"use strict";const e=require("../../common/vendor.js"),a=require("../../common/assets.js"),t=require("../../store/tag.js"),n=require("../../store/user.js"),o=require("../../store/time.js");if(!Array){(e.resolveComponent("uni-popup-dialog")+e.resolveComponent("uni-popup")+e.resolveComponent("tag-menu"))()}Math||((()=>"../../uni_modules/uni-popup/components/uni-popup-dialog/uni-popup-dialog.js")+(()=>"../../uni_modules/uni-popup/components/uni-popup/uni-popup.js")+(()=>"../tag-menu/tag-menu.js"))();const i={__name:"time-timer",setup(i){const r=e.inject("url"),d=n.useUserStore(),u=t.useTagStore(),s=o.useTimeStore(),m=e.reactive({remainingTime:0,hours:0,minutes:0,seconds:0,formattedTime:"",content:""});let l=null,p=e.ref(null),g=e.ref(null);e.onMounted((()=>{})),s.data.remainingTime=3600*u.data.tagHour+60*u.data.tagMinute+u.data.tagSecond;const c=e=>String(e).padStart(2,"0");s.data.formattedTime=e.computed((()=>(m.hours=Math.floor(s.data.remainingTime/3600),m.minutes=Math.floor(s.data.remainingTime%3600/60),m.seconds=Math.floor(s.data.remainingTime%60),`${c(m.hours)}:${c(m.minutes)}:${c(m.seconds)}`)));const f=()=>{null==u.data.tagName?e.index.showToast({icon:"none",title:"没有标签，快去建立吧"}):(s.data.showNav_menu=!1,l=setInterval((()=>{s.data.remainingTime--,s.data.remainingTime<=0&&(clearInterval(l),l=null,e.index.request({url:r+"/tag/finish",method:"POST",data:{tagName:u.data.tagName},success:e=>{console.log(e),d.data.point=e.data.data.tagPoint}}),clearInterval(l),l=null,s.data.remainingTime=3600*u.data.tagHour+60*u.data.tagMinute+u.data.tagSecond,s.data.ifbegin=!s.data.ifbegin,s.data.ifend=!s.data.ifend,m.content="本次计时获得 "+u.data.tagPoint+"points",g.value.open())}),1e3),s.data.ifbegin=!s.data.ifbegin,s.data.ifend=!s.data.ifend)},v=()=>{p.value.open()},h=()=>{s.data.showNav_menu=!0,clearInterval(l),l=null,s.data.remainingTime=3600*u.data.tagHour+60*u.data.tagMinute+u.data.tagSecond,s.data.ifbegin=!s.data.ifbegin,s.data.ifend=!s.data.ifend,p.value.close()},T=()=>{s.data.showNav_menu=!0,p.value.close()},b=()=>{s.data.showNav_menu=!0,g.value.close()},_=()=>{s.data.showNav_menu=!0,g.value.close()},j=()=>{u.data.ifshowTagMenu=!u.data.ifshowTagMenu};return e.onBeforeUnmount((()=>{clearInterval(l)})),(t,n)=>e.e({a:a._imports_0$7,b:e.t(e.unref(u).data.tagName),c:e.o(j),d:e.t(e.unref(s).data.formattedTime),e:e.unref(s).data.ifbegin},e.unref(s).data.ifbegin?{f:e.o(f)}:{},{g:e.unref(s).data.ifend},e.unref(s).data.ifend?{h:e.o(v)}:{},{i:e.o(T),j:e.o(h),k:e.p({type:"error",mode:"base",title:"确定要放弃吗?",content:"本次计时将不会得到任何分数",duration:2e3,"before-close":"true"}),l:e.sr(p,"4eec1b59-0",{k:"popup1"}),m:e.p({type:"dialog"}),n:e.o(_),o:e.o(b),p:e.p({type:"info",mode:"base",title:"计时结束",content:m.content,duration:2e3,"before-close":"true"}),q:e.sr(g,"4eec1b59-2",{k:"popup2"}),r:e.p({type:"dialog"})})}};wx.createComponent(i);
