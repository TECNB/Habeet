"use strict";const t=require("../../common/vendor.js"),a=require("../../common/assets.js"),e=require("../../store/target.js"),r=require("../../store/user.js");if(!Array){t.resolveComponent("uni-transition")()}Math;const o={__name:"target-menu",setup(o){const i=t.inject("url"),d=r.useUserStore(),s=e.useTargetStore();let n=new Date;n.getDate(),n.getDay(),n.getMonth();const g=t.reactive({showtargetMenuDetail:!1,showtargetArrowUp:!0,showtargetArrowDown:!1,targetWithTime:[],targetNoTime:[],dayList:[]});g.dayList.push({day:n.getDate(),month:n.getMonth(),className:"NumCenter"});const h=()=>{g.showtargetMenuDetail=!g.showtargetMenuDetail,g.showtargetArrowUp=!g.showtargetArrowUp,g.showtargetArrowDown=!g.showtargetArrowDown,0==g.targetNoTime.length&&0==g.targetWithTime.length&&t.index.showToast({icon:"none",title:"没有目标，快去建立吧"})};return t.index.request({url:i+"/target/get",method:"POST",data:{userEmail:d.data.userEmail,ifTargetUpdate:1},success:t=>{s.data.deadlineDate=[];for(let a=0;a<t.data.data.length;a++)if(0==t.data.data[a].status)g.targetNoTime.push({targetName:t.data.data[a].targetName,targetDescribe:t.data.data[a].targetDescribe,targetPoint:t.data.data[a].targetPoint,deadline:t.data.data[a].deadline,targetId:t.data.data[a].targetId});else if(1==t.data.data[a].status){let e=new Date(t.data.data[a].deadline);s.data.deadlineDate.includes(e)||s.data.deadlineDate.push(e),g.targetWithTime.push({targetName:t.data.data[a].targetName,targetDescribe:t.data.data[a].targetDescribe,targetPoint:t.data.data[a].targetPoint,deadline:t.data.data[a].deadline,targetId:t.data.data[a].targetId})}}}),t.onMounted((()=>{const t=new Date(n.getFullYear(),g.dayList[0].month,1);n=new Date(t),n.setDate(g.dayList[0].day),n.setMonth(g.dayList[0].month),s.data.currentTime=n.toString(),s.data.dayDiff=[],s.data.ifshowDay=[],s.data.deadlineDate.forEach((t=>{let a=new Date(s.data.currentTime),e=t.getTime()-a.getTime(),r=Math.floor(e/864e5);if(r>0)s.data.ifshowDay.push(!0);else if(r<0){r=`${t.getMonth()+1}.${t.getDate()}`,s.data.ifshowDay.push(!1)}else{r=`${t.getHours()}:${t.getMinutes().toString().padStart(2,"0")}`,s.data.ifshowDay.push(!1)}s.data.dayDiff.push(r)}))})),(e,r)=>t.e({a:g.showtargetArrowUp},g.showtargetArrowUp?{b:a._imports_0$8,c:t.o(h)}:{},{d:g.showtargetArrowDown},g.showtargetArrowDown?{e:a._imports_1$4,f:t.o(h)}:{},{g:t.f(g.targetNoTime,((a,e,r)=>({a:t.t(a.targetName),b:t.t(a.targetPoint),c:e,d:t.o((a=>(a=>{t.index.request({url:i+"/target/delete",method:"POST",data:{targetName:g.targetNoTime[a].targetName,ifPoints:1,userEmail:d.data.userEmail,targetId:g.targetNoTime[a].targetId},success:e=>{t.index.showToast({icon:"none",title:"完成目标"}),console.log(e),g.targetNoTime.splice(a,1),d.data.point=e.data.data.targetPoint}})})(e)),e)}))),h:a._imports_4,i:t.f(g.targetWithTime,((a,e,r)=>t.e({a:t.t(a.targetName),b:t.t(a.targetPoint),c:t.unref(s).data.ifshowDay[e]},(t.unref(s).data.ifshowDay[e],{}),{d:!t.unref(s).data.ifshowDay[e]},(t.unref(s).data.ifshowDay[e],{}),{e:t.t(t.unref(s).data.dayDiff[e]),f:t.unref(s).data.ifshowDay[e]},(t.unref(s).data.ifshowDay[e],{}),{g:e,h:t.o((a=>(a=>{t.index.request({url:i+"/target/delete",method:"POST",data:{targetName:g.targetWithTime[a].targetName,ifPoints:1,userEmail:d.data.userEmail,targetId:g.targetWithTime[a].targetId},success:e=>{t.index.showToast({icon:"none",title:"完成目标"}),console.log(e),g.targetWithTime.splice(a,1),d.data.point=e.data.data.targetPoint}})})(e)),e)}))),j:a._imports_4,k:t.p({"mode-class":"fade",show:g.showtargetMenuDetail,duration:"300"})})}};wx.createComponent(o);
